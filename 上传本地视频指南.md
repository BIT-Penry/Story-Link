# ğŸ“¹ ä¸Šä¼ æœ¬åœ°è§†é¢‘åˆ°æ•…äº‹ - å®Œæ•´æŒ‡å—

## ğŸ¯ ç›®æ ‡
å°†æœ¬åœ°è§†é¢‘æ–‡ä»¶ä¸Šä¼ å¹¶æ›¿æ¢"è’é‡çŒäºº"æ•…äº‹ä¸­çš„è§†é¢‘

## ğŸ“‹ å½“å‰æƒ…å†µ
- **æ•…äº‹ ID**: 5
- **æ•…äº‹æ ‡é¢˜**: è’é‡çŒäºº
- **ä½œè€…**: ssh
- **å½“å‰è§†é¢‘**: `/videos/mock_video.mp4` (Mock è§†é¢‘)
- **è§†é¢‘çŠ¶æ€**: completed

---

## ğŸš€ æ–¹æ³•ä¸€ï¼šæ‰‹åŠ¨æ›¿æ¢ï¼ˆæ¨èï¼Œæœ€ç®€å•ï¼‰

### æ­¥éª¤ 1: å‡†å¤‡ä½ çš„è§†é¢‘æ–‡ä»¶
ç¡®ä¿ä½ çš„è§†é¢‘æ–‡ä»¶ï¼š
- âœ… æ ¼å¼ä¸º `.mp4`
- âœ… æ–‡ä»¶å¤§å°åˆç†ï¼ˆå»ºè®® < 100MBï¼‰
- âœ… åˆ†è¾¨ç‡æ¨è 16:9ï¼ˆå¦‚ 1920x1080ï¼‰

### æ­¥éª¤ 2: å¤åˆ¶è§†é¢‘åˆ°é¡¹ç›®ç›®å½•

```bash
# å‡è®¾ä½ çš„æœ¬åœ°è§†é¢‘è·¯å¾„æ˜¯ ~/Downloads/my_video.mp4
# å°†å®ƒå¤åˆ¶åˆ°é¡¹ç›®çš„ videos ç›®å½•ï¼Œå¹¶é‡å‘½å

cp ~/Downloads/my_video.mp4 "/Applications/å®‹æ™—æ/é»‘å®¢æ¾/ä¸­å…³æ‘_22ç»„_hub/Story-Link/backend/videos/story_5_custom.mp4"
```

**âš ï¸ é‡è¦**ï¼š
- æ–‡ä»¶åå»ºè®®ä½¿ç”¨ `story_5_custom.mp4` æ ¼å¼
- `5` æ˜¯æ•…äº‹çš„ ID
- ç¡®ä¿æ–‡ä»¶åä¸­æ²¡æœ‰ç©ºæ ¼æˆ–ç‰¹æ®Šå­—ç¬¦

### æ­¥éª¤ 3: æ›´æ–°æ•°æ®åº“

```bash
# è¿›å…¥ backend ç›®å½•
cd "/Applications/å®‹æ™—æ/é»‘å®¢æ¾/ä¸­å…³æ‘_22ç»„_hub/Story-Link/backend"

# æ›´æ–°æ•°æ®åº“ä¸­çš„è§†é¢‘è·¯å¾„
sqlite3 moviehub.db "UPDATE stories SET video_url = '/videos/story_5_custom.mp4', video_status = 'completed' WHERE id = 5"

# éªŒè¯æ›´æ–°
sqlite3 moviehub.db "SELECT id, title, video_url, video_status FROM stories WHERE id = 5"
```

### æ­¥éª¤ 4: åˆ·æ–°å‰ç«¯é¡µé¢
åœ¨æµè§ˆå™¨ä¸­åˆ·æ–°é¡µé¢ï¼ˆhttp://localhost:5173ï¼‰ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°æ–°çš„è§†é¢‘ï¼

---

## ğŸš€ æ–¹æ³•äºŒï¼šä¸€é”®è„šæœ¬ï¼ˆè‡ªåŠ¨åŒ–ï¼‰

åˆ›å»ºä¸€ä¸ªå¿«æ·è„šæœ¬æ¥ç®€åŒ–æ“ä½œï¼š

### åˆ›å»ºä¸Šä¼ è„šæœ¬

```bash
cat > "/Applications/å®‹æ™—æ/é»‘å®¢æ¾/ä¸­å…³æ‘_22ç»„_hub/Story-Link/backend/upload_video.sh" << 'EOF'
#!/bin/bash

# ä¸Šä¼ æœ¬åœ°è§†é¢‘åˆ°æŒ‡å®šæ•…äº‹
# ç”¨æ³•: ./upload_video.sh <story_id> <è§†é¢‘æ–‡ä»¶è·¯å¾„>

if [ "$#" -ne 2 ]; then
    echo "ç”¨æ³•: $0 <story_id> <è§†é¢‘æ–‡ä»¶è·¯å¾„>"
    echo "ç¤ºä¾‹: $0 5 ~/Downloads/my_video.mp4"
    exit 1
fi

STORY_ID=$1
VIDEO_PATH=$2
DB_PATH="moviehub.db"
VIDEO_DIR="videos"

# æ£€æŸ¥è§†é¢‘æ–‡ä»¶æ˜¯å¦å­˜åœ¨
if [ ! -f "$VIDEO_PATH" ]; then
    echo "âŒ é”™è¯¯: è§†é¢‘æ–‡ä»¶ä¸å­˜åœ¨: $VIDEO_PATH"
    exit 1
fi

# æ£€æŸ¥æ–‡ä»¶æ‰©å±•å
if [[ ! "$VIDEO_PATH" =~ \.mp4$ ]]; then
    echo "âŒ é”™è¯¯: è§†é¢‘æ–‡ä»¶å¿…é¡»æ˜¯ .mp4 æ ¼å¼"
    exit 1
fi

# ç”Ÿæˆç›®æ ‡æ–‡ä»¶å
TIMESTAMP=$(date +%s)
TARGET_FILE="story_${STORY_ID}_${TIMESTAMP}.mp4"
TARGET_PATH="${VIDEO_DIR}/${TARGET_FILE}"

# å¤åˆ¶è§†é¢‘æ–‡ä»¶
echo "ğŸ“¹ å¤åˆ¶è§†é¢‘æ–‡ä»¶..."
cp "$VIDEO_PATH" "$TARGET_PATH"

if [ $? -ne 0 ]; then
    echo "âŒ å¤åˆ¶å¤±è´¥"
    exit 1
fi

echo "âœ… è§†é¢‘å·²å¤åˆ¶åˆ°: $TARGET_PATH"

# æ›´æ–°æ•°æ®åº“
echo "ğŸ—„ï¸  æ›´æ–°æ•°æ®åº“..."
sqlite3 "$DB_PATH" "UPDATE stories SET video_url = '/videos/${TARGET_FILE}', video_status = 'completed' WHERE id = ${STORY_ID}"

if [ $? -ne 0 ]; then
    echo "âŒ æ•°æ®åº“æ›´æ–°å¤±è´¥"
    exit 1
fi

echo "âœ… æ•°æ®åº“æ›´æ–°æˆåŠŸ"

# éªŒè¯æ›´æ–°
echo ""
echo "ğŸ“Š å½“å‰æ•…äº‹è§†é¢‘ä¿¡æ¯:"
sqlite3 "$DB_PATH" "SELECT id, title, video_url, video_status FROM stories WHERE id = ${STORY_ID}"

echo ""
echo "ğŸ‰ è§†é¢‘ä¸Šä¼ æˆåŠŸï¼åˆ·æ–°æµè§ˆå™¨å³å¯è§‚çœ‹ã€‚"
EOF

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x "/Applications/å®‹æ™—æ/é»‘å®¢æ¾/ä¸­å…³æ‘_22ç»„_hub/Story-Link/backend/upload_video.sh"
```

### ä½¿ç”¨è„šæœ¬

```bash
cd "/Applications/å®‹æ™—æ/é»‘å®¢æ¾/ä¸­å…³æ‘_22ç»„_hub/Story-Link/backend"

# ä¸Šä¼ è§†é¢‘åˆ°æ•…äº‹ ID 5ï¼ˆè’é‡çŒäººï¼‰
./upload_video.sh 5 ~/Downloads/my_video.mp4
```

---

## ğŸ¬ æ–¹æ³•ä¸‰ï¼šé€šè¿‡ Python è„šæœ¬ï¼ˆç¨‹åºåŒ–ï¼‰

åˆ›å»ºä¸€ä¸ª Python è„šæœ¬æ¥ç®¡ç†è§†é¢‘ä¸Šä¼ ï¼š

```python
# upload_video.py
import os
import sys
import sqlite3
import shutil
from pathlib import Path
from datetime import datetime

def upload_video(story_id: int, video_path: str):
    """ä¸Šä¼ è§†é¢‘åˆ°æŒ‡å®šæ•…äº‹"""
    
    # æ£€æŸ¥è§†é¢‘æ–‡ä»¶
    video_file = Path(video_path)
    if not video_file.exists():
        print(f"âŒ é”™è¯¯: è§†é¢‘æ–‡ä»¶ä¸å­˜åœ¨: {video_path}")
        return False
    
    if video_file.suffix.lower() != '.mp4':
        print(f"âŒ é”™è¯¯: è§†é¢‘æ–‡ä»¶å¿…é¡»æ˜¯ .mp4 æ ¼å¼")
        return False
    
    # å‡†å¤‡ç›®æ ‡è·¯å¾„
    video_dir = Path("videos")
    video_dir.mkdir(exist_ok=True)
    
    timestamp = int(datetime.now().timestamp())
    target_filename = f"story_{story_id}_{timestamp}.mp4"
    target_path = video_dir / target_filename
    
    # å¤åˆ¶è§†é¢‘
    print(f"ğŸ“¹ å¤åˆ¶è§†é¢‘æ–‡ä»¶...")
    try:
        shutil.copy2(video_path, target_path)
        print(f"âœ… è§†é¢‘å·²å¤åˆ¶åˆ°: {target_path}")
    except Exception as e:
        print(f"âŒ å¤åˆ¶å¤±è´¥: {e}")
        return False
    
    # æ›´æ–°æ•°æ®åº“
    print(f"ğŸ—„ï¸  æ›´æ–°æ•°æ®åº“...")
    try:
        conn = sqlite3.connect("moviehub.db")
        cursor = conn.cursor()
        
        cursor.execute(
            "UPDATE stories SET video_url = ?, video_status = 'completed' WHERE id = ?",
            (f"/videos/{target_filename}", story_id)
        )
        
        conn.commit()
        
        # éªŒè¯æ›´æ–°
        cursor.execute(
            "SELECT id, title, video_url, video_status FROM stories WHERE id = ?",
            (story_id,)
        )
        result = cursor.fetchone()
        
        print(f"âœ… æ•°æ®åº“æ›´æ–°æˆåŠŸ")
        print(f"\nğŸ“Š å½“å‰æ•…äº‹è§†é¢‘ä¿¡æ¯:")
        print(f"ID: {result[0]}")
        print(f"æ ‡é¢˜: {result[1]}")
        print(f"è§†é¢‘URL: {result[2]}")
        print(f"çŠ¶æ€: {result[3]}")
        
        conn.close()
        
    except Exception as e:
        print(f"âŒ æ•°æ®åº“æ›´æ–°å¤±è´¥: {e}")
        return False
    
    print(f"\nğŸ‰ è§†é¢‘ä¸Šä¼ æˆåŠŸï¼åˆ·æ–°æµè§ˆå™¨å³å¯è§‚çœ‹ã€‚")
    return True

if __name__ == "__main__":
    if len(sys.argv) != 3:
        print("ç”¨æ³•: python upload_video.py <story_id> <è§†é¢‘æ–‡ä»¶è·¯å¾„>")
        print("ç¤ºä¾‹: python upload_video.py 5 ~/Downloads/my_video.mp4")
        sys.exit(1)
    
    story_id = int(sys.argv[1])
    video_path = sys.argv[2]
    
    upload_video(story_id, video_path)
```

### ä½¿ç”¨ Python è„šæœ¬

```bash
cd "/Applications/å®‹æ™—æ/é»‘å®¢æ¾/ä¸­å…³æ‘_22ç»„_hub/Story-Link/backend"

# ä¸Šä¼ è§†é¢‘
python3 upload_video.py 5 ~/Downloads/my_video.mp4
```

---

## ğŸ” éªŒè¯è§†é¢‘æ˜¯å¦æ›¿æ¢æˆåŠŸ

### 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
```bash
ls -lh "/Applications/å®‹æ™—æ/é»‘å®¢æ¾/ä¸­å…³æ‘_22ç»„_hub/Story-Link/backend/videos/"
```

### 2. æ£€æŸ¥æ•°æ®åº“è®°å½•
```bash
cd "/Applications/å®‹æ™—æ/é»‘å®¢æ¾/ä¸­å…³æ‘_22ç»„_hub/Story-Link/backend"
sqlite3 moviehub.db "SELECT id, title, video_url, video_status FROM stories WHERE id = 5"
```

åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
```
5|è’é‡çŒäºº|ssh|/videos/story_5_1761459856.mp4|completed
```

### 3. åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•
1. è®¿é—® http://localhost:5173
2. æ‰¾åˆ°"è’é‡çŒäºº"æ•…äº‹å¡ç‰‡
3. ç‚¹å‡»"æŸ¥çœ‹è¯¦æƒ…"
4. è§†é¢‘æ’­æ”¾å™¨åº”è¯¥æ˜¾ç¤ºä½ ä¸Šä¼ çš„è§†é¢‘

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: è§†é¢‘ä¸æ˜¾ç¤ºæ€ä¹ˆåŠï¼Ÿ
**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆ`python3 main.py`ï¼‰
2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å¹¶åˆ·æ–°
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
4. ç¡®è®¤è§†é¢‘æ–‡ä»¶è·¯å¾„åœ¨æ•°æ®åº“ä¸­æ­£ç¡®

### Q2: è§†é¢‘æ’­æ”¾å™¨æ˜¾ç¤ºé”™è¯¯ï¼Ÿ
**A**: å¯èƒ½çš„åŸå› ï¼š
1. è§†é¢‘æ ¼å¼ä¸å…¼å®¹ - ç¡®ä¿æ˜¯ H.264 ç¼–ç çš„ MP4
2. æ–‡ä»¶æƒé™é—®é¢˜ - ç¡®ä¿æ–‡ä»¶å¯è¯»
3. è§†é¢‘æ–‡ä»¶æŸå - å°è¯•ç”¨å…¶ä»–æ’­æ”¾å™¨æµ‹è¯•

### Q3: å¦‚ä½•è½¬æ¢è§†é¢‘æ ¼å¼ï¼Ÿ
**A**: ä½¿ç”¨ ffmpeg è½¬æ¢ï¼š
```bash
# å®‰è£… ffmpeg (å¦‚æœæ²¡æœ‰)
brew install ffmpeg

# è½¬æ¢è§†é¢‘ä¸ºå…¼å®¹æ ¼å¼
ffmpeg -i input.mov -c:v libx264 -c:a aac -movflags +faststart output.mp4
```

### Q4: å¦‚ä½•æ‰¹é‡ä¸Šä¼ å¤šä¸ªè§†é¢‘ï¼Ÿ
**A**: ä½¿ç”¨å¾ªç¯è„šæœ¬ï¼š
```bash
# æ‰¹é‡ä¸Šä¼ 
for story_id in 5 6 7; do
    ./upload_video.sh $story_id ~/Downloads/video_${story_id}.mp4
done
```

---

## ğŸ¯ å¿«é€Ÿä¸Šä¼ ï¼ˆå¤åˆ¶ç²˜è´´å³ç”¨ï¼‰

å‡è®¾ä½ çš„è§†é¢‘åœ¨ `~/Downloads/my_video.mp4`ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# ä¸€é”®æ›¿æ¢è’é‡çŒäººçš„è§†é¢‘
cd "/Applications/å®‹æ™—æ/é»‘å®¢æ¾/ä¸­å…³æ‘_22ç»„_hub/Story-Link/backend"

# å¤åˆ¶è§†é¢‘
cp ~/Downloads/my_video.mp4 videos/story_5_custom.mp4

# æ›´æ–°æ•°æ®åº“
sqlite3 moviehub.db "UPDATE stories SET video_url = '/videos/story_5_custom.mp4', video_status = 'completed' WHERE id = 5"

# éªŒè¯
sqlite3 moviehub.db "SELECT id, title, video_url FROM stories WHERE id = 5"

echo "âœ… å®Œæˆï¼åˆ·æ–°æµè§ˆå™¨é¡µé¢æŸ¥çœ‹æ–°è§†é¢‘"
```

---

## ğŸ“š ç›¸å…³æ–‡ä»¶ä½ç½®

- **è§†é¢‘ç›®å½•**: `backend/videos/`
- **æ•°æ®åº“**: `backend/moviehub.db`
- **åç«¯API**: `backend/main.py`
- **è§†é¢‘æ’­æ”¾ç»„ä»¶**: `frontend/src/pages/StoryDetailPage.jsx`

---

## âœ¨ æç¤º

1. **è§†é¢‘å‘½åè§„èŒƒ**: `story_{id}_{timestamp}.mp4`
2. **æ¨èåˆ†è¾¨ç‡**: 1920x1080 (16:9)
3. **æ¨èæ—¶é•¿**: 15-30 ç§’
4. **æ–‡ä»¶å¤§å°**: å»ºè®® < 100MB
5. **ç¼–ç æ ¼å¼**: H.264 (æœ€å…¼å®¹)

---

ç°åœ¨ä½ å¯ä»¥å¼€å§‹ä¸Šä¼ ä½ çš„æœ¬åœ°è§†é¢‘äº†ï¼ğŸ¬

