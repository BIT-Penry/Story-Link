# 🔄 重启 MovieHub 指南

## 🎉 最新更新: 协作续写功能 (2025-10-26)

### ✨ 新功能说明

现在续写功能已改为**协作模式**：

- ✅ 续写会**添加到原故事**，而不是创建新故事
- ✅ 首页只显示**原创故事**（续写不单独显示）
- ✅ 详情页显示**原创+所有续写内容**
- ✅ 生成视频使用**完整内容**（包含所有续写）
- ✅ 只有**原作者**可以生成视频

### 📖 快速测试

1. 用户A创建故事《中关村》
2. 用户B续写《中关村》
3. 首页仍然只显示**一个**《中关村》
4. 点击查看，可以看到A的原创和B的续写
5. 只有用户A可以生成视频（包含A+B的内容）

📚 详细文档:
- 测试指南: `docs/协作续写功能测试.md`
- 实现总结: `docs/协作续写功能实现总结.md`

---

## 问题原因
后端使用了 `python` 命令，macOS 上应该用 `python3`，已修复。

## 🛑 停止当前服务

### 1. 在运行 start.sh 的终端按 `Ctrl+C`

### 2. 确保所有进程都停止了
```bash
# 检查并杀死可能残留的进程
lsof -ti:8000 | xargs kill -9 2>/dev/null
lsof -ti:3000 | xargs kill -9 2>/dev/null
lsof -ti:5173 | xargs kill -9 2>/dev/null
```

## 🚀 重新启动（推荐手动启动）

### 方法1: 使用修复后的脚本
```bash
cd /Applications/宋晗搏/黑客松/中关村_22组_hub/Story-Link
./start.sh
```

### 方法2: 手动启动（推荐，更稳定）

#### 终端1 - 启动后端
```bash
cd /Applications/宋晗搏/黑客松/中关村_22组_hub/Story-Link/backend

# 激活虚拟环境（如果有）
source venv/bin/activate

# 启动后端
python3 main.py
```

**预期输出**:
```
✅ 数据库初始化完成
✅ 数据库迁移完成
✅ Mock 视频已存在: videos/mock_video.mp4
INFO:     Uvicorn running on http://0.0.0.0:8000
```

#### 终端2 - 启动前端
```bash
cd /Applications/宋晗搏/黑客松/中关村_22组_hub/Story-Link/frontend
npm run dev
```

**预期输出**:
```
VITE v6.x.x  ready in xxx ms
➜  Local:   http://localhost:5173/
```

## 🌐 访问地址

- 前端: http://localhost:5173
- 后端: http://localhost:8000
- API文档: http://localhost:8000/docs

## ✅ 验证服务正常

### 1. 测试后端
```bash
curl http://localhost:8000/
```
应该返回: `{"message":"StoryLink API is running!","version":"1.0.0"}`

### 2. 测试前端
打开浏览器访问: http://localhost:5173

## 🐛 如果还是卡住

### 检查1: 后端是否真的在运行
```bash
lsof -i:8000
```
如果没有输出，说明后端没有运行

### 检查2: 浏览器控制台
按 `F12` 打开开发者工具，查看 Console 和 Network 标签页的错误

### 检查3: 清除浏览器缓存
- `Cmd+Shift+R` (macOS) 强制刷新
- 或清除 localStorage: 
  ```javascript
  localStorage.clear()
  location.reload()
  ```

## 💡 常见问题

### Q: 前端显示"加载中..."一直不动
**A**: 后端没有启动成功，检查后端终端输出

### Q: 昵称弹窗不出现
**A**: 
1. 按 F12 打开控制台
2. 在 Console 输入: `localStorage.clear()`
3. 刷新页面

### Q: 端口被占用
**A**: 
```bash
# 查看占用端口的进程
lsof -i:8000  # 或 :5173

# 杀死进程
kill -9 <PID>
```

---

## 🎯 快速操作

```bash
# 一键停止所有服务
lsof -ti:8000,3000,5173 | xargs kill -9 2>/dev/null

# 一键重启（手动启动法）
# 终端1:
cd /Applications/宋晗搏/黑客松/中关村_22组_hub/Story-Link/backend && python3 main.py

# 终端2:
cd /Applications/宋晗搏/黑客松/中关村_22组_hub/Story-Link/frontend && npm run dev
```

